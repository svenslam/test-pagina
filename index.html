<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>iPhone Alarm & Camera</title>
<style>
body { font-family: sans-serif; text-align:center; background:#111; color:#eee; }
video, canvas { width:90%; max-width:400px; margin:10px; }
#keypad { display:none; margin-top:20px; }
.btn { padding:10px 20px; margin:5px; font-size:16px; cursor:pointer; }
.digit { width:60px; height:60px; font-size:24px; }
</style>
</head>
<body>
<h1>üì± iPhone Alarm & Camera</h1>

<div>
<button class="btn" onclick="startCamera('user')">Voorkant camera</button>
<button class="btn" onclick="startCamera('environment')">Achterkant camera</button>
<button class="btn" onclick="takePhoto()">üì∏ Foto maken</button>
</div>
<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<hr>
<div>
<button class="btn" onclick="enableMotion()">Start sensoren</button>
<button class="btn" onclick="activateAlarm()">üö® Alarm Aan</button>
<button class="btn" onclick="showKeypad()">‚ùå Alarm Uit</button>
</div>

<div id="keypad"></div>

<audio id="siren" loop>
<source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<script>
let stream, video = document.getElementById('video'), canvas = document.getElementById('canvas');
let alarmActive = false, motionPermission = false;
let audioCtx, oscillator, siren = document.getElementById('siren');
let moving = false;
let moveTime = 0; // cumulatieve tijd in ms
let lastUpdate = null;
let sirenStarted = false;

async function startCamera(facingMode) {
if(stream) stream.getTracks().forEach(t => t.stop());
try {
stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode } });
video.srcObject = stream;
} catch(e){ alert("Camera niet toegankelijk: " + e); }
}

function takePhoto() {
if(!stream) return alert("Camera niet actief");
canvas.width = video.videoWidth; canvas.height = video.videoHeight;
canvas.getContext('2d').drawImage(video,0,0);
canvas.toBlob(blob => {
let a = document.createElement('a');
a.href = URL.createObjectURL(blob);
a.download = "foto.jpg";
a.click();
}, 'image/jpeg');
}

function enableMotion(){
if (typeof DeviceMotionEvent.requestPermission === 'function') {
DeviceMotionEvent.requestPermission().then(res=>{
if(res === 'granted'){ motionPermission = true; alert("Bewegingssensor geactiveerd"); }
});
} else { motionPermission = true; alert("Bewegingssensor geactiveerd"); }
}

function activateAlarm(){
if(!motionPermission) return alert("Eerst sensoren activeren!");
alarmActive = true; alert("Alarm ingeschakeld");
moveTime = 0; sirenStarted = false; lastUpdate = null;
window.addEventListener('devicemotion', handleMotion);
}

function handleMotion(e){
if(!alarmActive || sirenStarted) return;

let ax = e.acceleration.x||0, ay = e.acceleration.y||0, az = e.acceleration.z||0;
let g = Math.sqrt(ax*ax+ay*ay+az*az);
let now = Date.now();

if(g > 1){ // beweging gedetecteerd
if(lastUpdate) {
moveTime += (now - lastUpdate);
}
lastUpdate = now;

if(!moving){
moving = true;
startTone();
}
if(oscillator) oscillator.frequency.value = 200 + moveTime/10;

if(moveTime >= 2000){ // 2 sec totaal
stopTone();
startSiren();
sirenStarted = true;
}
} else {
moving = false;
stopTone();
lastUpdate = now;
}
}

function startTone(){
if(audioCtx) return;
audioCtx = new (window.AudioContext||window.webkitAudioContext)();
oscillator = audioCtx.createOscillator();
oscillator.type = "sine";
oscillator.frequency.value = 200;
oscillator.connect(audioCtx.destination);
oscillator.start();
}
function stopTone(){
if(oscillator){ oscillator.stop(); oscillator.disconnect(); }
oscillator=null; audioCtx=null;
}
function startSiren(){ siren.play(); }
function stopSiren(){ siren.pause(); siren.currentTime=0; }

function showKeypad(){
let kp = document.getElementById('keypad');
kp.style.display = 'block'; kp.innerHTML='';
let input = document.createElement('input'); input.type='password'; input.id='pin'; input.readOnly=true;
kp.appendChild(input); kp.appendChild(document.createElement('br'));
for(let i=1;i<=9;i++){ addBtn(i,kp); if(i%3==0) kp.appendChild(document.createElement('br')); }
addBtn(0,kp);
let ok = document.createElement('button'); ok.className="digit"; ok.textContent="OK";
ok.onclick=()=>{ if(input.value==="1968"){ deactivateAlarm(); } else { input.value=''; } };
kp.appendChild(ok);
}
function addBtn(n,kp){
let b=document.createElement('button'); b.className='digit'; b.textContent=n;
b.onclick=()=>{ document.getElementById('pin').value+=n; };
kp.appendChild(b);
}

function deactivateAlarm(){
alarmActive=false; stopTone(); stopSiren();
window.removeEventListener('devicemotion', handleMotion);
document.getElementById('keypad').style.display='none';
alert("Alarm gedeactiveerd");
}
</script>
</body>
</html>
