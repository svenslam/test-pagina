<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPhone Sensor App</title>
<style>
body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
#menu, #gMeter, #alarmSystem { display: none; }
canvas { border: 1px solid #000; width: 100%; height: 200px; }
.keypad { display: grid; grid-template-columns: repeat(3, 80px); gap: 10px; justify-content: center; margin-top: 20px; }
.keypad button { font-size: 20px; padding: 15px; }
</style>
</head>
<body>
<h1>iPhone Sensor Demo</h1>

<div id="menu">
<button onclick="startGMeter()">G-kracht Meter</button>
<button onclick="startAlarm()">Alarm Systeem</button>
</div>

<div id="gMeter">
<h2>G-kracht Meter</h2>
<canvas id="gCanvas" width="400" height="200"></canvas><br>
<button onclick="stopGMeter()">Stop</button>
</div>

<div id="alarmSystem">
<h2>Alarm Systeem</h2>
<p>Status: <span id="alarmStatus">Inactief</span></p>
<audio id="alarmSound" loop>
<source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>
<div class="keypad" id="keypad"></div>
</div>

<script>
document.getElementById("menu").style.display = "block";

let gRunning = false, gData = [], gCtx;
function startGMeter() {
document.getElementById("menu").style.display = "none";
document.getElementById("gMeter").style.display = "block";
const canvas = document.getElementById("gCanvas");
gCtx = canvas.getContext("2d");
gData = [];
gRunning = true;
window.addEventListener("devicemotion", gHandler);
}
function gHandler(event) {
if (!gRunning) return;
let acc = event.accelerationIncludingGravity;
if (!acc) return;
let g = Math.sqrt(acc.x*acc.x + acc.y*acc.y + acc.z*acc.z) / 9.81;
gData.push(g);
if (gData.length > 100) gData.shift();
drawGraph();
}
function drawGraph() {
gCtx.clearRect(0,0,400,200);
gCtx.beginPath();
gCtx.moveTo(0,200 - gData[0]*50);
for (let i=1;i<gData.length;i++) {
gCtx.lineTo(i*4, 200 - gData[i]*50);
}
gCtx.stroke();
}
function stopGMeter() {
gRunning = false;
window.removeEventListener("devicemotion", gHandler);
document.getElementById("gMeter").style.display = "none";
document.getElementById("menu").style.display = "block";
}

// Alarm systeem
let alarmActive = false;
let alarmTimer = null;
let alarmSound = document.getElementById("alarmSound");

function startAlarm() {
document.getElementById("menu").style.display = "none";
document.getElementById("alarmSystem").style.display = "block";
document.getElementById("alarmStatus").innerText = "Bewaking actief";
alarmActive = false;
alarmTimer = null;
window.addEventListener("devicemotion", alarmMotion);
buildKeypad();
}

function alarmMotion(event) {
let acc = event.accelerationIncludingGravity;
if (!acc) return;
let total = Math.sqrt(acc.x*acc.x + acc.y*acc.y + acc.z*acc.z);
let diff = Math.abs(total - 9.81);

if (diff > 1.5) { // drempelwaarde beweging
if (!alarmTimer) {
alarmTimer = setTimeout(triggerAlarm, 2000); // 2 sec beweging
}
} else {
clearTimeout(alarmTimer);
alarmTimer = null;
}
}

function triggerAlarm() {
alarmActive = true;
document.getElementById("alarmStatus").innerText = "ALARM!";
alarmSound.play();
let msg = new SpeechSynthesisUtterance("Alarm! Telefoon verplaatst!");
window.speechSynthesis.speak(msg);
}

function buildKeypad() {
const keypad = document.getElementById("keypad");
keypad.innerHTML = "";
let code = "";
const correct = "1968";
for (let i=1;i<=9;i++) {
let btn = document.createElement("button");
btn.innerText = i;
btn.onclick = ()=> {
code += i;
if (code === correct) {
deactivateAlarm();
code = "";
} else if (code.length >= 4) {
code = "";
}
};
keypad.appendChild(btn);
}
let zero = document.createElement("button");
zero.innerText = "0";
zero.onclick = ()=> {
code += "0";
if (code === correct) {
deactivateAlarm();
code = "";
} else if (code.length >= 4) {
code = "";
}
};
keypad.appendChild(zero);
}

function deactivateAlarm() {
alarmActive = false;
document.getElementById("alarmStatus").innerText = "Alarm gedeactiveerd";
alarmSound.pause();
alarmSound.currentTime = 0;
window.speechSynthesis.cancel();
}
</script>
</body>
</html>
